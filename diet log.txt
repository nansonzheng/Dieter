HeavenClient Investigation Log:

2019-10-30 02:48 - Started log. Recount of past events:
	- Attempted build. Encountered Error TRK0005: cannot locate CL.exe
	- Error TRK0005 resolved: uninstalled Visual Studio 14.0 (2015) and ran vcvars64.bat
	- Attempted build. Success
	- Launched in debug mode. Missing .nx files
	
02:56 - Started .wz -> .nx file conversions. Copied .wz files to NoLifeStory folder. Missing Map001.wz. UI.wz required to be of version 154+.

03:00 - Found official v154 installer.

03:25 - Uninstalled v83. Installed v154. v154 does not have Map001.wz either. Temporarily ignoring Map001.wz. Made back-up of v83's UI.wz. Copied v154's UI.wz into the folder. Converting files.
	- Map001.wz is found on the Steam version of MapleStory, but I have to reinstall it to get the file, and my computer is running out of disk space.
	
03:37 - Map001.wz is required, as specified in the .cpp files.

05:34 - Installed latest MapleStory on Steam. Retrieved Map001.wz and converted. Encountered error: nlnx could not locate nx files.
	- Reason: Base.nx or Data.nx was not provided
	
05:39 - Converted Base.nx and Morph.nx. Debug successfully starts client. Require account to proceed.

11:54 - Created account. Failed to login: message was "Password is incorrect". Attempted to rebuild without cryptography, but failed due to errors in cryptography.cpp.

12:15 - Cannot log in with credentials "nanson" and "password", with message "This is not a registered ID".
	- Message "Password is invalid" is due to password length being less than 8?
	- Not querying DB correctly
	
12:47 - Log in issue resolved: added column "fly" to table accounts. Entered a channel. Created a character. Error occurred while finalizing character creation: screenshot on discord.

12:51 - Second account's character creation also failed at the same point. Both accounts unable to log into a channel afterwards.

12:55 - Deleting character resolved channel log in issue.

13:25 - Speculating post character creation crash issue to be charlooks not populated after character creation. Channel log in issue is likely a separate problem.

13:49 - method add_character should push character data into charlooks, testing if it was called

14:08 - Client may be expecting packet containing character info after creation

15:15 - Found problem in packet reading: parse_look had recv ahead by 1 byte. Attempting fix by reducing skips in parse_stats (last method called) by 1

15:20 - Problem appears to be solved, continuing searching the root cause

15:42 - Found that level is being read as a short rather than a byte.

15:48 - Marking character creation issue as solved.

20:33 - Started investigating UI issue.

20:45 - Replaced UI.nx with the latest copy from the official servers. UI is visible again. Death issue persists. Party creation persists. 
	- New issue: chat commands do not work. 
	- New issue: rope/ladder cannot be grabbed mid-air unless character changes direction first ("counter-strafe")
	- New issue: cannot drag settings, key bindings windows
	- New issue: when dragging a window, dragging it on top of another window drops the drag. If moving fast enough, it may be able to maintain drag on the same window, but the cursor position relative to the window clearly has moved.
	- Considering re-building .nx files using only v154 .wz files, except Map001.wz which is absent
	
20:58 - Client reports actions not handled:
	- 12: Whisper
	- 13: All Chat
	- 14: Party Chat
	- 18: Guild
	- 19: Friend Chat
	- 21: Notifier
	- 24: Cash Shop
	- 25: Guild Chat
	- 28: Medals
	- 30: Alliance Chat
	- 31: Maple News
	- 32: Manage Legion
	- 33: Profession
	- 35: Item pot
	- 37: Silent Crusade
	- 38: Battle Analysis
	- 39: Guide
	- 41: Enhance Equip
	- 42: Monster collection
	- 43: Soul weapon
	- 44: Char info
	- 48: Picture Mode
	- 49: Maple Achievements
	- 55: interact / harvest
	- 58: Mute
	- 59: Monster book
	- 60: To spouse
	
	- Unhandled packet Opcode 214. Occurred while picking up an NXCash card. Later NXCash Card pickups did not trigger this warning.
	
	- New issue: Change channel shows wrong world and channel.
	- New issue: Opening Maple Chat locks up movement if a second window pops up (hard to reproduce)
	- New issue: Cannot drag skill
	- New issue: Minimap displays nothing
	- New issue: Skill Macros have no skill icons
	
2019-10-31 23:48 - Attempted start-up, game failed to move to game state after character selection, but changed resolution/window size.

2019-11-01 21:35 - Game entry failure is caused by stack underflow while trying to read area info

2019-11-04 04:52 - Second character entered Amherst, relogged without problem. Judging cause to be character data. Will need to jump into server codebase to check packet format and why area info is required and/or put in.

17:07 - Monster book data appears not to have been read. (Addendum: Read correctly)

18:13 - Issue resolved. Cause of game entry failure is an unread short meant to be read in parse_minigame. This caused the read head to be 2 bytes behind the supposed address.